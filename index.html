<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚è¨ˆã‚¢ãƒ—ãƒª</title>
    <!-- Tailwind CSSã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ã‚¢ã‚¤ã‚³ãƒ³ã®ãŸã‚ã«Lucide Iconsã‚’èª­ã¿è¾¼ã¿ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa; /* æ˜ã‚‹ã„èƒŒæ™¯ */
        }
        .container-shadow {
            /* ã‚·ãƒ³ãƒ—ãƒ«ãªå½±è‰²ï¼ˆé»’ã®ã¿ï¼‰ã«å¤‰æ›´ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
        }
        .time-display {
            font-variant-numeric: tabular-nums; /* æ•°å­—ã®å¹…ã‚’æƒãˆã‚‹ */
            font-weight: 700;
        }
        /* ã‚¢ãƒ©ãƒ¼ãƒ é³´å‹•æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes alarm-ring {
            0% { background-color: #fca5a5; transform: scale(1); } /* è–„ã„èµ¤ */
            50% { background-color: #ef4444; transform: scale(1.02); } /* æ¿ƒã„èµ¤ */
            100% { background-color: #fca5a5; transform: scale(1); }
        }
        .alarm-ringing {
            animation: alarm-ring 0.5s infinite alternate;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º (Tailwindã§ã¯é™ç•ŒãŒã‚ã‚‹ãŸã‚ã‚«ã‚¹ã‚¿ãƒ CSSã‚’ä½¿ç”¨) */
        .custom-file-input::-webkit-file-upload-button {
            visibility: hidden;
        }
        .custom-file-input::before {
            content: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ';
            display: inline-block;
            background: #d1d5db; /* bg-gray-300 */
            color: #1f2937; /* text-gray-800 */
            border-radius: 9999px;
            padding: 0.5rem 1rem;
            outline: none;
            white-space: nowrap;
            cursor: pointer;
            font-weight: 600;
            margin-right: 1rem;
            transition: all 0.2s;
        }
        .custom-file-input:hover::before {
            background: #e5e7eb; /* bg-gray-200 */
        }
        .custom-file-input:active::before {
            background: #9ca3af; /* bg-gray-400 */
        }
        .file-status-text {
            /* ãƒ•ã‚¡ã‚¤ãƒ«åãŒé•·ã™ãã‚‹å ´åˆã®å¯¾å¿œ */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="app-container" class="w-full max-w-lg bg-white rounded-2xl p-6 md:p-10 text-gray-950 container-shadow transition-all duration-500">
        
        <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ (ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³ã¨æ–‡å­—è‰²ã‚‚é»’ã«å¤‰æ›´) -->
        <div class="flex border-b border-gray-300 mb-6">
            <button id="tab-clock" class="tab-button flex-1 py-3 text-sm font-medium border-b-2 border-gray-950 text-gray-950 transition-colors duration-200" data-target="clock-view">
                <span class="md:hidden">â±ï¸</span><span class="hidden md:inline">æ™‚è¨ˆ</span>
            </button>
            <button id="tab-alarm" class="tab-button flex-1 py-3 text-sm font-medium border-b-2 border-transparent text-gray-700 hover:text-gray-950 transition-colors duration-200" data-target="alarm-view">
                <span class="md:hidden">ğŸš¨</span><span class="hidden md:inline">ã‚¢ãƒ©ãƒ¼ãƒ </span>
            </button>
            <button id="tab-stopwatch" class="tab-button flex-1 py-3 text-sm font-medium border-b-2 border-transparent text-gray-700 hover:text-gray-950 transition-colors duration-200" data-target="stopwatch-view">
                <span class="md:hidden">â³</span><span class="hidden md:inline">ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒ</span>
            </button>
            <button id="tab-timer" class="tab-button flex-1 py-3 text-sm font-medium border-b-2 border-transparent text-gray-700 hover:text-gray-950 transition-colors duration-200" data-target="timer-view">
                <span class="md:hidden">â²ï¸</span><span class="hidden md:inline">ã‚¿ã‚¤ãƒãƒ¼</span>
            </button>
        </div>

        <!-- æ™‚è¨ˆãƒ“ãƒ¥ãƒ¼ -->
        <div id="clock-view" class="view">
            <h2 class="text-xl font-semibold mb-4 text-center text-gray-950">ç¾åœ¨ã®æ™‚åˆ»</h2>
            <div id="current-time" class="time-display text-7xl md:text-8xl text-center mb-2 text-gray-950">00:00:00</div>
            <div id="current-date" class="text-lg text-center text-gray-700">YYYYå¹´MæœˆDæ—¥ (æ›œæ—¥)</div>
        </div>

        <!-- ã‚¢ãƒ©ãƒ¼ãƒ ãƒ“ãƒ¥ãƒ¼ -->
        <div id="alarm-view" class="view hidden">
            <h2 class="text-xl font-semibold mb-6 text-center text-gray-950">ã‚¢ãƒ©ãƒ¼ãƒ è¨­å®š</h2>
            
            <div class="flex justify-center mb-6 space-x-4">
                <input type="time" id="alarm-time-input" class="bg-gray-100 text-gray-950 p-3 rounded-lg text-2xl border border-gray-300 focus:ring-gray-950 focus:border-gray-950" value="07:00">
                <!-- ãƒœã‚¿ãƒ³ã®è‰²ã¯æ©Ÿèƒ½æ€§ã‚’ä¿ã¤ãŸã‚æ®‹ã—ã¾ã™ -->
                <button id="set-alarm-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105">
                    è¨­å®š
                </button>
            </div>
            
            <!-- ã‚«ã‚¹ã‚¿ãƒ éŸ³æºå…¥åŠ›æ¬„ -->
            <div class="mb-6 px-4">
                <label for="alarm-audio-file" class="block text-sm font-medium text-gray-700 mb-2">ã‚«ã‚¹ã‚¿ãƒ éŸ³æº (MP3/WAV)</label>
                <input type="file" id="alarm-audio-file" accept="audio/mp3, audio/wav, audio/ogg" class="w-full text-sm text-gray-700 custom-file-input">
                <span id="alarm-file-status" class="text-xs mt-1 text-gray-700 file-status-text">æœªè¨­å®š: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</span>
            </div>

            <div id="alarm-status" class="text-center text-red-600 text-sm mb-4"></div>
            
            <div class="bg-gray-100 p-4 rounded-lg">
                <h3 class="font-medium text-gray-950 mb-2">è¨­å®šæ¸ˆã¿ã‚¢ãƒ©ãƒ¼ãƒ </h3>
                <ul id="alarms-list" class="space-y-2">
                    <!-- ã‚¢ãƒ©ãƒ¼ãƒ ã‚¢ã‚¤ãƒ†ãƒ ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                </ul>
                <p id="no-alarm-message" class="text-gray-700 text-sm text-center mt-2">ç¾åœ¨ã€ã‚¢ãƒ©ãƒ¼ãƒ ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
            </div>
            
            <!-- ã‚¢ãƒ©ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ/åœæ­¢ãƒœã‚¿ãƒ³ï¼‰ -->
            <div id="alarm-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
                <div id="alarm-modal-content" class="bg-red-600 text-white p-8 rounded-xl shadow-2xl w-full max-w-sm text-center alarm-ringing">
                    <p class="text-5xl mb-4 animate-bounce">ğŸš¨</p>
                    <h3 class="text-3xl font-bold mb-6">æ™‚é–“ã§ã™ï¼</h3>
                    <button id="dismiss-alarm-btn" class="bg-white text-red-600 font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-200 transition-colors">
                        åœæ­¢
                    </button>
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒãƒ“ãƒ¥ãƒ¼ -->
        <div id="stopwatch-view" class="view hidden">
            <h2 class="text-xl font-semibold mb-4 text-center text-gray-950">ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒ</h2>
            <div id="stopwatch-display" class="time-display text-6xl md:text-7xl text-center mb-8 text-gray-950">00:00.00</div>

            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
            <div class="flex justify-center space-x-4 mb-8">
                <button id="sw-start-btn" class="control-btn bg-green-600 hover:bg-green-700 text-white">é–‹å§‹</button>
                <button id="sw-stop-btn" class="control-btn bg-red-600 hover:bg-red-700 text-white hidden">åœæ­¢</button>
                <button id="sw-reset-btn" class="control-btn bg-gray-500 hover:bg-gray-600 text-white" disabled>ãƒªã‚»ãƒƒãƒˆ</button>
                <button id="sw-lap-btn" class="control-btn bg-blue-600 hover:bg-blue-700 text-white" disabled>ãƒ©ãƒƒãƒ—</button>
            </div>

            <!-- ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒˆ -->
            <div class="bg-gray-100 p-4 rounded-lg max-h-48 overflow-y-auto">
                <h3 class="font-medium text-gray-950 mb-2">ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ </h3>
                <ul id="lap-times-list" class="divide-y divide-gray-300">
                    <!-- ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                </ul>
                <p id="no-lap-message" class="text-gray-700 text-sm text-center mt-2">ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            </div>
        </div>

        <!-- ã‚¿ã‚¤ãƒãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
        <div id="timer-view" class="view hidden">
            <h2 class="text-xl font-semibold mb-6 text-center text-gray-950">ã‚¿ã‚¤ãƒãƒ¼</h2>

            <!-- ã‚¿ã‚¤ãƒãƒ¼è¨­å®šå…¥åŠ› -->
            <div class="flex justify-center items-center space-x-2 mb-8">
                <input type="number" id="timer-h-input" placeholder="H" min="0" max="99" value="0" class="timer-input bg-gray-100 text-gray-950 p-3 rounded-lg text-2xl w-16 text-center border border-gray-300 focus:ring-gray-950 focus:border-gray-950">
                <span class="text-3xl">:</span>
                <input type="number" id="timer-m-input" placeholder="M" min="0" max="59" value="5" class="timer-input bg-gray-100 text-gray-950 p-3 rounded-lg text-2xl w-16 text-center border border-gray-300 focus:ring-gray-950 focus:border-gray-950">
                <span class="text-3xl">:</span>
                <input type="number" id="timer-s-input" placeholder="S" min="0" max="59" value="0" class="timer-input bg-gray-100 text-gray-950 p-3 rounded-lg text-2xl w-16 text-center border border-gray-300 focus:ring-gray-950 focus:border-gray-950">
            </div>

            <!-- ã‚«ã‚¹ã‚¿ãƒ éŸ³æºå…¥åŠ›æ¬„ -->
            <div class="mb-6 px-4">
                <label for="timer-audio-file" class="block text-sm font-medium text-gray-700 mb-2">ã‚«ã‚¹ã‚¿ãƒ éŸ³æº (MP3/WAV)</label>
                <input type="file" id="timer-audio-file" accept="audio/mp3, audio/wav, audio/ogg" class="w-full text-sm text-gray-700 custom-file-input">
                <span id="timer-file-status" class="text-xs mt-1 text-gray-700 file-status-text">æœªè¨­å®š: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</span>
            </div>

            <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º (é€šå¸¸æ™‚ã‚‚é»’ã«å¤‰æ›´) -->
            <div id="timer-display" class="time-display text-6xl md:text-7xl text-center mb-8 text-gray-950">00:05:00</div>

            <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
            <div class="flex justify-center space-x-4">
                <button id="timer-start-btn" class="control-btn bg-green-600 hover:bg-green-700 text-white">é–‹å§‹</button>
                <button id="timer-pause-btn" class="control-btn bg-yellow-600 hover:bg-yellow-700 text-white hidden">ä¸€æ™‚åœæ­¢</button>
                <button id="timer-resume-btn" class="control-btn bg-green-600 hover:bg-green-700 text-white hidden">å†é–‹</button>
                <button id="timer-reset-btn" class="control-btn bg-gray-500 hover:bg-gray-600 text-white" disabled>ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <!-- ã‚¿ã‚¤ãƒãƒ¼å®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ/åœæ­¢ãƒœã‚¿ãƒ³ï¼‰ -->
            <div id="timer-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
                <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ã¯æ©Ÿèƒ½ã‚’ä¿ã¤ãŸã‚æ®‹ã—ã¾ã™ -->
                <div class="bg-purple-600 text-white p-8 rounded-xl shadow-2xl w-full max-w-sm text-center">
                    <p class="text-5xl mb-4 animate-ping">ğŸ””</p>
                    <h3 class="text-3xl font-bold mb-6">ã‚¿ã‚¤ãƒãƒ¼å®Œäº†ï¼</h3>
                    <button id="dismiss-timer-btn" class="bg-white text-purple-600 font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-200 transition-colors">
                        é–‰ã˜ã‚‹
                    </button>
                </div>
            </div>
        </div>

        <!-- Tone.jsã‚’ä½¿ã£ãŸåŠ¹æœéŸ³ã®èª­ã¿è¾¼ã¿ (ã‚¢ãƒ©ãƒ¼ãƒ /ã‚¿ã‚¤ãƒãƒ¼ç”¨) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
        
    </div>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const appContainer = document.getElementById('app-container');
        const tabButtons = document.querySelectorAll('.tab-button');
        const views = document.querySelectorAll('.view');
        
        // æ™‚è¨ˆ
        const currentTimeEl = document.getElementById('current-time');
        const currentDateEl = document.getElementById('current-date');

        // ã‚¢ãƒ©ãƒ¼ãƒ 
        const alarmTimeInput = document.getElementById('alarm-time-input');
        const setAlarmBtn = document.getElementById('set-alarm-btn');
        const alarmStatusEl = document.getElementById('alarm-status');
        const alarmsList = document.getElementById('alarms-list');
        const noAlarmMessage = document.getElementById('no-alarm-message');
        const alarmModal = document.getElementById('alarm-modal');
        const dismissAlarmBtn = document.getElementById('dismiss-alarm-btn');
        const alarmModalContent = document.getElementById('alarm-modal-content');
        const alarmAudioFileInput = document.getElementById('alarm-audio-file'); 
        const alarmFileStatusEl = document.getElementById('alarm-file-status'); 
        
        let alarms = [];
        let alarmCheckInterval;
        const synth = new Tone.MembraneSynth().toDestination(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒ©ãƒ¼ãƒ éŸ³æº
        let customAlarmPlayer = null; // ã‚«ã‚¹ã‚¿ãƒ éŸ³æºç”¨ Tone.Player
        let alarmInterval = null;

        // ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒ
        const swDisplay = document.getElementById('stopwatch-display');
        const swStartBtn = document.getElementById('sw-start-btn');
        const swStopBtn = document.getElementById('sw-stop-btn');
        const swResetBtn = document.getElementById('sw-reset-btn');
        const swLapBtn = document.getElementById('sw-lap-btn');
        const lapTimesList = document.getElementById('lap-times-list');
        const noLapMessage = document.getElementById('no-lap-message');
        let swInterval = null;
        let swStartTime = 0;
        let swElapsedTime = 0;
        let swIsRunning = false;
        let lapCount = 0;

        // ã‚¿ã‚¤ãƒãƒ¼
        const timerHInput = document.getElementById('timer-h-input');
        const timerMInput = document.getElementById('timer-m-input');
        const timerSInput = document.getElementById('timer-s-input');
        const timerDisplay = document.getElementById('timer-display');
        const timerStartBtn = document.getElementById('timer-start-btn');
        const timerPauseBtn = document.getElementById('timer-pause-btn');
        const timerResumeBtn = document.getElementById('timer-resume-btn');
        const timerResetBtn = document.getElementById('timer-reset-btn');
        const timerModal = document.getElementById('timer-modal');
        const dismissTimerBtn = document.getElementById('dismiss-timer-btn');
        const timerAudioFileInput = document.getElementById('timer-audio-file'); 
        const timerFileStatusEl = document.getElementById('timer-file-status'); 
        
        let timerInterval = null;
        let timerDuration = 300; // åˆæœŸå€¤: 5åˆ† (ç§’å˜ä½)
        let timerRemaining = timerDuration;
        let timerIsRunning = false;
        const timerSynth = new Tone.DuoSynth().toDestination(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒãƒ¼å®Œäº†éŸ³æº
        let customTimerPlayer = null; // ã‚«ã‚¹ã‚¿ãƒ éŸ³æºç”¨ Tone.Player

        // **ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé–‹å§‹ã®å…±é€šé–¢æ•°**
        let audioContextStarted = false;
        function startAudioContextOnce() {
            if (!audioContextStarted && Tone.context.state !== 'running') {
                Tone.start().then(() => {
                    console.log('Tone.js AudioContext started by user interaction.');
                    audioContextStarted = true;
                }).catch(e => {
                    console.error('Failed to start Tone.js AudioContext:', e);
                });
            }
        }
        
        // **æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã§ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’é–‹å§‹**
        document.body.addEventListener('click', startAudioContextOnce, { once: true });


        // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ---

        /**
         * ç§’æ•°ã‚’ HH:MM:SS ã¾ãŸã¯ MM:SS.ff å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹
         * @param {number} totalSeconds - ç§’æ•°
         * @param {boolean} includeMillis - ãƒŸãƒªç§’ã‚’å«ã‚ã‚‹ã‹ã©ã†ã‹
         * @returns {string} ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸæ™‚é–“æ–‡å­—åˆ—
         */
        function formatTime(totalSeconds, includeMillis = false) {
            let totalMillis = Math.round(totalSeconds * 1000);
            
            const hours = Math.floor(totalMillis / (1000 * 60 * 60));
            totalMillis %= (1000 * 60 * 60);
            
            const minutes = Math.floor(totalMillis / (1000 * 60));
            totalMillis %= (1000 * 60);
            
            const seconds = Math.floor(totalMillis / 1000);
            const millis = Math.floor((totalMillis % 1000) / 10); // 10ãƒŸãƒªç§’å˜ä½ã§è¡¨ç¤º
            
            const h = String(hours).padStart(2, '0');
            const m = String(minutes).padStart(2, '0');
            const s = String(seconds).padStart(2, '0');
            const ms = String(millis).padStart(2, '0');

            if (includeMillis) {
                // ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒå½¢å¼ (MM:SS.ff)
                return `${m}:${s}.${ms}`;
            } else if (hours > 0) {
                // ã‚¿ã‚¤ãƒãƒ¼å½¢å¼ (HH:MM:SS) - ã‚¿ã‚¤ãƒãƒ¼ãŒ1æ™‚é–“ä»¥ä¸Šã®å ´åˆ
                 return `${h}:${m}:${s}`;
            } else {
                // ã‚¿ã‚¤ãƒãƒ¼å½¢å¼ (MM:SS) - ã‚¿ã‚¤ãƒãƒ¼ãŒ1æ™‚é–“æœªæº€ã®å ´åˆ
                return `${m}:${s}`;
            }
        }

        // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ ---

        function setActiveTab(targetId) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
            tabButtons.forEach(btn => {
                if (btn.dataset.target === targetId) {
                    btn.classList.remove('border-transparent', 'text-gray-700', 'hover:text-gray-950');
                    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’é»’ã«è¨­å®š
                    btn.classList.add('border-gray-950', 'text-gray-950');
                } else {
                    btn.classList.remove('border-gray-950', 'text-gray-950');
                    btn.classList.add('border-transparent', 'text-gray-700', 'hover:text-gray-950');
                }
            });

            // ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤º
            views.forEach(view => {
                if (view.id === targetId) {
                    view.classList.remove('hidden');
                } else {
                    view.classList.add('hidden');
                }
            });
        }

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                startAudioContextOnce();
                setActiveTab(btn.dataset.target);
            });
        });

        // --- ã‚«ã‚¹ã‚¿ãƒ éŸ³æºæ©Ÿèƒ½ ---
        
        /**
         * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã‚’Tone.js Playerã¨ã—ã¦è¨­å®šã™ã‚‹
         * @param {HTMLInputElement} fileInput - ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›è¦ç´ 
         * @param {string} type - 'alarm' or 'timer'
         */
        function setupCustomAudio(fileInput, type) {
            const file = fileInput.files[0];
            const statusEl = type === 'alarm' ? alarmFileStatusEl : timerFileStatusEl;
            let customPlayerRef = type === 'alarm' ? customAlarmPlayer : customTimerPlayer;

            // æ—¢å­˜ã®Playerã‚’åœæ­¢ãƒ»è§£æ”¾
            if (customPlayerRef && customPlayerRef.state === 'started') {
                customPlayerRef.stop();
            }
            if (customPlayerRef) {
                customPlayerRef.dispose();
            }

            if (!file) {
                // ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¯ãƒªã‚¢ã•ã‚ŒãŸå ´åˆ
                customPlayerRef = null;
                statusEl.textContent = 'æœªè¨­å®š: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚';
                statusEl.classList.remove('text-blue-600', 'text-red-600', 'text-yellow-700');
                statusEl.classList.add('text-gray-700'); // æ–‡å­—è‰²ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã«æˆ»ã™
                if (type === 'alarm') customAlarmPlayer = null;
                else customTimerPlayer = null;
                return;
            }

            const fileUrl = URL.createObjectURL(file);
            statusEl.textContent = `èª­ã¿è¾¼ã¿ä¸­... (${file.name})`;
            statusEl.classList.remove('text-blue-600', 'text-red-600', 'text-gray-700');
            statusEl.classList.add('text-yellow-700');

            // Tone.js Playerã‚’åˆæœŸåŒ–
            const Player = new Tone.Player({
                url: fileUrl,
                loop: true, // ã‚¢ãƒ©ãƒ¼ãƒ /ã‚¿ã‚¤ãƒãƒ¼ã¯ãƒ«ãƒ¼ãƒ—å†ç”Ÿ
                autostart: false,
                onload: () => {
                    statusEl.textContent = `âœ… ${file.name} ã‚’è¨­å®šã—ã¾ã—ãŸã€‚`;
                    statusEl.classList.remove('text-yellow-700');
                    // èª­ã¿è¾¼ã¿å®Œäº†è‰²ã¯çµ±ä¸€ã—ã¦é’ç³»ï¼ˆç¢ºèªè‰²ï¼‰ã«è¨­å®š
                    statusEl.classList.add('text-blue-600'); 
                },
                onerror: (e) => {
                    statusEl.textContent = `âŒ ${file.name} ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚`;
                    statusEl.classList.remove('text-yellow-700');
                    statusEl.classList.add('text-red-600');
                    Player.dispose();
                    customPlayerRef = null; // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç„¡åŠ¹åŒ–
                    console.error("Audio loading error:", e);
                }
            }).toDestination();
            
            if (type === 'alarm') customAlarmPlayer = Player;
            else customTimerPlayer = Player;
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        alarmAudioFileInput.addEventListener('change', () => setupCustomAudio(alarmAudioFileInput, 'alarm'));
        timerAudioFileInput.addEventListener('change', () => setupCustomAudio(timerAudioFileInput, 'timer'));

        // --- 1. æ™‚è¨ˆæ©Ÿèƒ½ ---

        function updateClock() {
            const now = new Date();
            
            // æ™‚åˆ»è¡¨ç¤º
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const timeString = now.toLocaleTimeString('ja-JP', timeOptions);
            currentTimeEl.textContent = timeString;

            // æ—¥ä»˜è¡¨ç¤º
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
            const dateString = now.toLocaleDateString('ja-JP', dateOptions).replace(/ /g, '');
            currentDateEl.textContent = dateString;
        }

        // 1ç§’ã”ã¨ã«æ™‚è¨ˆã‚’æ›´æ–°
        setInterval(updateClock, 1000);
        updateClock(); // åˆå›å®Ÿè¡Œ

        // --- 2. ã‚¢ãƒ©ãƒ¼ãƒ æ©Ÿèƒ½ ---

        /**
         * ã‚¢ãƒ©ãƒ¼ãƒ ãƒªã‚¹ãƒˆã‚’DOMã«æç”»ã™ã‚‹
         */
        function renderAlarms() {
            alarmsList.innerHTML = '';
            alarms.sort((a, b) => a.time.localeCompare(b.time)); // æ™‚åˆ»é †ã«ã‚½ãƒ¼ãƒˆ

            if (alarms.length === 0) {
                noAlarmMessage.classList.remove('hidden');
            } else {
                noAlarmMessage.classList.add('hidden');
                alarms.forEach((alarm, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'flex items-center justify-between p-3 rounded-md bg-white shadow-sm';
                    
                    const timeSpan = document.createElement('span');
                    timeSpan.textContent = alarm.time;
                    // ã‚¢ãƒ©ãƒ¼ãƒ æ™‚åˆ»ã‚‚é»’ã«è¨­å®š
                    timeSpan.className = 'text-2xl font-mono text-gray-950';

                    const deleteBtn = document.createElement('button');
                    deleteBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-red-500 hover:text-red-400"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>';
                    deleteBtn.title = 'ã‚¢ãƒ©ãƒ¼ãƒ ã‚’å‰Šé™¤';
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        deleteAlarm(index)
                    });

                    listItem.appendChild(timeSpan);
                    listItem.appendChild(deleteBtn);
                    alarmsList.appendChild(listItem);
                });
            }
        }

        /**
         * ã‚¢ãƒ©ãƒ¼ãƒ ã‚’è¨­å®šã™ã‚‹
         */
        setAlarmBtn.addEventListener('click', () => {
            const time = alarmTimeInput.value;
            if (time && !alarms.some(a => a.time === time)) {
                alarms.push({ time: time, triggered: false });
                alarmStatusEl.textContent = `${time}ã«ã‚¢ãƒ©ãƒ¼ãƒ ã‚’è¨­å®šã—ã¾ã—ãŸã€‚`;
                alarmStatusEl.classList.add('text-blue-600'); // ç¢ºèªè‰²ã¯é’ç³»ã«å¤‰æ›´
                alarmStatusEl.classList.remove('text-red-600');
                renderAlarms();
            } else if (alarms.some(a => a.time === time)) {
                alarmStatusEl.textContent = `ã™ã§ã«${time}ã®ã‚¢ãƒ©ãƒ¼ãƒ ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚`;
                alarmStatusEl.classList.add('text-red-600');
                alarmStatusEl.classList.remove('text-blue-600');
            } else {
                alarmStatusEl.textContent = 'æœ‰åŠ¹ãªæ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                alarmStatusEl.classList.add('text-red-600');
                alarmStatusEl.classList.remove('text-blue-600');
            }
        });

        /**
         * ã‚¢ãƒ©ãƒ¼ãƒ ã‚’å‰Šé™¤ã™ã‚‹
         * @param {number} index - å‰Šé™¤ã™ã‚‹ã‚¢ãƒ©ãƒ¼ãƒ ã®é…åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
         */
        function deleteAlarm(index) {
            const time = alarms[index].time;
            alarms.splice(index, 1);
            alarmStatusEl.textContent = `${time}ã®ã‚¢ãƒ©ãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`;
            alarmStatusEl.classList.add('text-red-600');
            alarmStatusEl.classList.remove('text-blue-600');
            renderAlarms();
        }

        /**
         * ã‚¢ãƒ©ãƒ¼ãƒ ã®ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ï¼ˆæ¯ç§’å®Ÿè¡Œï¼‰
         */
        function checkAlarms() {
            const now = new Date();
            const nowTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            const nowSecond = now.getSeconds();

            // æ¯åˆ†0ç§’ã«ãªã£ãŸç¬é–“ã«ãƒã‚§ãƒƒã‚¯
            if (nowSecond === 0) {
                const pendingAlarms = alarms.filter(a => a.time === nowTime && !a.triggered);
                
                if (pendingAlarms.length > 0) {
                    // ã‚¢ãƒ©ãƒ¼ãƒ ã‚’ãƒˆãƒªã‚¬ãƒ¼
                    pendingAlarms.forEach(alarm => alarm.triggered = true);
                    triggerAlarm();
                }
            }
        }

        /**
         * ã‚¢ãƒ©ãƒ¼ãƒ ã‚’é³´ã‚‰ã™ (ã‚«ã‚¹ã‚¿ãƒ éŸ³æºå¯¾å¿œ)
         */
        function triggerAlarm() {
            alarmModal.classList.remove('hidden');

            if (customAlarmPlayer && customAlarmPlayer.loaded) {
                // ã‚«ã‚¹ã‚¿ãƒ éŸ³æºã‚’ä½¿ç”¨
                customAlarmPlayer.start();
                alarmInterval = null; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³æºã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã¯ä¸è¦
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³æºã‚’ä½¿ç”¨
                const playSound = () => {
                    synth.triggerAttackRelease("C4", "8n");
                    synth.triggerAttackRelease("G4", "8n", "+4n");
                };
                
                playSound();
                // 0.5ç§’ã”ã¨ã«éŸ³ã‚’é³´ã‚‰ã™
                alarmInterval = setInterval(playSound, 500); 
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ç‚¹æ»…ã•ã›ã‚‹
            alarmModalContent.classList.add('alarm-ringing');
        }

        /**
         * ã‚¢ãƒ©ãƒ¼ãƒ ã‚’åœæ­¢ã™ã‚‹
         */
        dismissAlarmBtn.addEventListener('click', () => {
            alarmModal.classList.add('hidden');
            
            // 1. ã‚«ã‚¹ã‚¿ãƒ éŸ³æºã‚’åœæ­¢
            if (customAlarmPlayer && customAlarmPlayer.state === 'started') {
                customAlarmPlayer.stop();
            }

            // 2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³æºã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’åœæ­¢
            if (alarmInterval) {
                clearInterval(alarmInterval);
                alarmInterval = null;
            }

            alarmModalContent.classList.remove('alarm-ringing');
            
            // é³´ã‚Šçµ‚ã‚ã£ãŸã‚¢ãƒ©ãƒ¼ãƒ ã‚’ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
            alarms = alarms.filter(a => !a.triggered);
            renderAlarms();
        });

        // 1ç§’ã”ã¨ã«ã‚¢ãƒ©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯ã‚’é–‹å§‹
        alarmCheckInterval = setInterval(checkAlarms, 1000);
        renderAlarms();

        // --- 3. ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒæ©Ÿèƒ½ ---

        /**
         * ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã®è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
         */
        function updateStopwatchDisplay() {
            const totalSeconds = swElapsedTime / 1000;
            swDisplay.textContent = formatTime(totalSeconds, true);
        }

        /**
         * ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã‚’é–‹å§‹ã™ã‚‹
         */
        swStartBtn.addEventListener('click', () => {
            if (!swIsRunning) {
                startAudioContextOnce(); 
                
                // é–‹å§‹æ™‚åˆ»ã‚’ç¾åœ¨æ™‚åˆ»ã‹ã‚‰çµŒéæ™‚é–“ã‚’å¼•ã„ãŸå€¤ã«è¨­å®š
                swStartTime = Date.now() - swElapsedTime; 
                swInterval = setInterval(() => {
                    swElapsedTime = Date.now() - swStartTime;
                    updateStopwatchDisplay();
                }, 10); // 10ãƒŸãƒªç§’ã”ã¨ã«æ›´æ–°
                
                swIsRunning = true;
                swStartBtn.classList.add('hidden');
                swStopBtn.classList.remove('hidden');
                swResetBtn.disabled = false;
                swLapBtn.disabled = false;
            }
        });

        /**
         * ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã‚’åœæ­¢ã™ã‚‹
         */
        swStopBtn.addEventListener('click', () => {
            if (swIsRunning) {
                clearInterval(swInterval);
                swIsRunning = false;
                swStartBtn.classList.remove('hidden');
                swStopBtn.classList.add('hidden');
            }
        });

        /**
         * ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
         */
        swResetBtn.addEventListener('click', () => {
            clearInterval(swInterval);
            swIsRunning = false;
            swStartTime = 0;
            swElapsedTime = 0;
            lapCount = 0;
            lapTimesList.innerHTML = '';
            swDisplay.textContent = '00:00.00';
            
            swStartBtn.classList.remove('hidden');
            swStopBtn.classList.add('hidden');
            swResetBtn.disabled = true;
            swLapBtn.disabled = true;
            noLapMessage.classList.remove('hidden');
        });

        /**
         * ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ ã‚’è¨˜éŒ²ã™ã‚‹
         */
        swLapBtn.addEventListener('click', () => {
            if (swIsRunning) {
                lapCount++;
                const lapTime = swElapsedTime / 1000;
                const totalTimeFormatted = formatTime(lapTime, true);
                
                const listItem = document.createElement('li');
                listItem.className = 'flex justify-between py-2 text-sm text-gray-950'; 
                listItem.innerHTML = `
                    <span class="text-gray-700">ãƒ©ãƒƒãƒ— ${String(lapCount).padStart(2, '0')}</span>
                    <span class="font-mono text-gray-950">${totalTimeFormatted}</span>
                `;
                lapTimesList.prepend(listItem); // æ–°ã—ã„ãƒ©ãƒƒãƒ—ã‚’ä¸€ç•ªä¸Šã«è¿½åŠ 
                noLapMessage.classList.add('hidden');
            }
        });

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã®ãƒœã‚¿ãƒ³ã‚’åˆæœŸè¨­å®š
        swStartBtn.disabled = false; // åˆæœŸçŠ¶æ…‹ã§ã¯é–‹å§‹å¯èƒ½

        // --- 4. ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ ---

        /**
         * ã‚¿ã‚¤ãƒãƒ¼ã®è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
         */
        function updateTimerDisplay() {
            const totalSeconds = timerRemaining;
            timerDisplay.textContent = formatTime(totalSeconds);

            // æ®‹ã‚Šæ™‚é–“ãŒ5ç§’ä»¥ä¸‹ã«ãªã£ãŸã‚‰æ–‡å­—ã‚’èµ¤ãã™ã‚‹ï¼ˆç·Šæ€¥åº¦ã‚’ç¤ºã™ãŸã‚ã“ã“ã¯èµ¤ã‚’ç¶­æŒï¼‰
            if (timerRemaining <= 5 && timerRemaining > 0) {
                 timerDisplay.classList.remove('text-gray-950');
                 timerDisplay.classList.add('text-red-600', 'animate-pulse');
            } else {
                 // é€šå¸¸æ™‚ã¯é»’ã«æˆ»ã™
                 timerDisplay.classList.add('text-gray-950');
                 timerDisplay.classList.remove('text-red-600', 'animate-pulse');
            }
        }

        /**
         * ã‚¿ã‚¤ãƒãƒ¼ã®åˆæœŸè¨­å®šï¼ˆå…¥åŠ›å€¤ã‹ã‚‰Durationã‚’è¨­å®šï¼‰
         */
        function setTimerDurationFromInput() {
            // å…¥åŠ›å€¤ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º
            const h = Math.min(99, Math.max(0, parseInt(timerHInput.value) || 0));
            const m = Math.min(59, Math.max(0, parseInt(timerMInput.value) || 0));
            const s = Math.min(59, Math.max(0, parseInt(timerSInput.value) || 0));

            timerHInput.value = h;
            timerMInput.value = m;
            timerSInput.value = s;

            timerDuration = h * 3600 + m * 60 + s;
            timerRemaining = timerDuration;
            
            // 0ç§’è¨­å®šã‚’å›é¿
            if (timerDuration <= 0) {
                timerDuration = 60; // 1åˆ†ã«å¼·åˆ¶è¨­å®š
                timerRemaining = 60;
                timerMInput.value = 1;
                timerSInput.value = 0;
            }
            
            updateTimerDisplay();
        }

        // å…¥åŠ›å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰Durationã‚’æ›´æ–°
        [timerHInput, timerMInput, timerSInput].forEach(input => {
            input.addEventListener('input', setTimerDurationFromInput);
        });
        setTimerDurationFromInput(); // åˆå›è¨­å®š

        /**
         * ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã™ã‚‹
         */
        timerStartBtn.addEventListener('click', () => {
            startAudioContextOnce(); 
            
            setTimerDurationFromInput(); // ç¢ºå®Ÿã«æœ€æ–°ã®è¨­å®šã§é–‹å§‹

            if (!timerIsRunning && timerRemaining > 0) {
                timerIsRunning = true;
                timerInterval = setInterval(() => {
                    timerRemaining--;
                    updateTimerDisplay();

                    if (timerRemaining <= 0) {
                        clearInterval(timerInterval);
                        timerIsRunning = false;
                        triggerTimerEnd();
                    }
                }, 1000);

                // UIã®åˆ‡ã‚Šæ›¿ãˆ
                timerStartBtn.classList.add('hidden');
                timerPauseBtn.classList.remove('hidden');
                timerResumeBtn.classList.add('hidden');
                timerResetBtn.disabled = false;
                toggleTimerInputs(true);
            }
        });

        /**
         * ã‚¿ã‚¤ãƒãƒ¼ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹
         */
        timerPauseBtn.addEventListener('click', () => {
            if (timerIsRunning) {
                clearInterval(timerInterval);
                timerIsRunning = false;
                timerPauseBtn.classList.add('hidden');
                timerResumeBtn.classList.remove('hidden');
                toggleTimerInputs(false);
            }
        });

        /**
         * ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹ã™ã‚‹
         */
        timerResumeBtn.addEventListener('click', () => {
            if (!timerIsRunning && timerRemaining > 0) {
                startAudioContextOnce(); 

                timerIsRunning = true;
                timerInterval = setInterval(() => {
                    timerRemaining--;
                    updateTimerDisplay();

                    if (timerRemaining <= 0) {
                        clearInterval(timerInterval);
                        timerIsRunning = false;
                        triggerTimerEnd();
                    }
                }, 1000);
                
                timerResumeBtn.classList.add('hidden');
                timerPauseBtn.classList.remove('hidden');
                toggleTimerInputs(true);
            }
        });


        /**
         * ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
         */
        timerResetBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            timerIsRunning = false;
            timerRemaining = timerDuration;
            updateTimerDisplay();
            
            // UIã®åˆ‡ã‚Šæ›¿ãˆ
            timerStartBtn.classList.remove('hidden');
            timerPauseBtn.classList.add('hidden');
            timerResumeBtn.classList.add('hidden');
            timerResetBtn.disabled = true;
            toggleTimerInputs(false);
        });
        
        /**
         * ã‚¿ã‚¤ãƒãƒ¼ã®å…¥åŠ›æ¬„ã‚’ç„¡åŠ¹åŒ–/æœ‰åŠ¹åŒ–ã™ã‚‹
         */
        function toggleTimerInputs(disable) {
            timerHInput.disabled = disable;
            timerMInput.disabled = disable;
            timerSInput.disabled = disable;
            // æ˜ã‚‹ã„ãƒ¢ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦ä¸é€æ˜åº¦ã‚’èª¿æ•´
            timerHInput.classList.toggle('opacity-60', disable);
            timerMInput.classList.toggle('opacity-60', disable);
            timerSInput.classList.toggle('opacity-60', disable);
        }

        /**
         * ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†æ™‚ã«ã‚¢ãƒ©ãƒ¼ãƒ ã‚’é³´ã‚‰ã™ (ã‚«ã‚¹ã‚¿ãƒ éŸ³æºå¯¾å¿œ)
         */
        function triggerTimerEnd() {
            timerModal.classList.remove('hidden');
            
            if (customTimerPlayer && customTimerPlayer.loaded) {
                // ã‚«ã‚¹ã‚¿ãƒ éŸ³æºã‚’ä½¿ç”¨
                customTimerPlayer.start();
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³æºã‚’ä½¿ç”¨
                timerSynth.triggerAttackRelease("C4", "1n"); 
                timerSynth.triggerAttackRelease("G3", "1n", "+0.5"); 
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‰ã˜ã‚‰ã‚ŒãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
            dismissTimerBtn.addEventListener('click', () => {
                timerModal.classList.add('hidden');
                // ã‚«ã‚¹ã‚¿ãƒ éŸ³æºã‚’åœæ­¢
                if (customTimerPlayer && customTimerPlayer.state === 'started') {
                    customTimerPlayer.stop();
                }
                timerResetBtn.click(); // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã®ã¨åŒã˜å‡¦ç†
            }, { once: true }); // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ä¸€åº¦ã ã‘å®Ÿè¡Œ

        }
    </script>
</body>
</html>
